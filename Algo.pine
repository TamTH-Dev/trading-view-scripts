//@version=6
indicator(title = "Algo", overlay = true, timeframe = "", timeframe_gaps = true)


//-----------------------------------------------------------------------------
// Constants
//-----------------------------------------------------------------------------
// Colors
color TRANSPARENT_COLOR = #ffffff00
color WHITE_COLOR       = #dee2e6
color BLACK_COLOR       = #000000
color RED_COLOR         = #F72585
color ORANGE_COLOR      = #fb5607
color YELLOW_COLOR      = #ffbe0b
color GREEN_COLOR       = #2a9d8f
color AQUA_COLOR        = #4CC9F0
color BLUE_COLOR        = #4361ee
color PURPLE_COLOR      = #3F37C9
color PINK_COLOR        = #B5179E
color LIGHT_GRAY_COLOR  = #364156
color DARK_GRAY_COLOR   = #212d40
color TEXT_COLOR        = #ced4da

//-----------------------------------------------------------------------------


//-----------------------------------------------------------------------------
// EMAs
//-----------------------------------------------------------------------------
// Settings
//-----------------------------------------------------------------------------
string ema1Inl = "EMA 1"
bool ema1Act = input.bool(true, "EMA 1", inline = ema1Inl)
string ema1Tf  = input.timeframe("", title = "", inline = ema1Inl)
int ema1Len = input.int(20, minval = 1, title = "", inline = ema1Inl)
color ema1Col = input.color(color.new(AQUA_COLOR, 35), title = "", inline = ema1Inl)

string ema2Inl = "EMA 2"
bool ema2Act = input.bool(true, "EMA 2", inline = ema2Inl)
string ema2Tf  = input.timeframe("", title = "", inline = ema2Inl)
int ema2Len = input.int(50, minval = 1, title = "", inline = ema2Inl)
color ema2Col = input.color(color.new(PURPLE_COLOR, 35), title = "", inline = ema2Inl)

string ema3Inl = "EMA 3"
bool ema3Act = input.bool(true, "EMA 3", inline = ema3Inl)
string ema3Tf  = input.timeframe("", title = "", inline = ema3Inl)
int ema3Len = input.int(200, minval = 1, title = "", inline = ema3Inl)
color ema3Col = input.color(color.new(PINK_COLOR, 35), title = "", inline = ema3Inl)

//-----------------------------------------------------------------------------
// Calculations
//-----------------------------------------------------------------------------
series float src = close

method getEma(bool active, string tf, series float src, int len) =>
    series float rs = na
    series float ema = ta.ema(src, len)
    if timeframe.period == "" and active
        rs := ema
    else if timeframe.period != "" and active
        rs := request.security(syminfo.tickerid, tf, ema)
    rs


series float ema1 = getEma(ema1Act, ema1Tf, src, ema1Len)
series float ema2 = getEma(ema2Act, ema2Tf, src, ema2Len)
series float ema3 = getEma(ema3Act, ema3Tf, src, ema3Len)

//-----------------------------------------------------------------------------
// Render
//-----------------------------------------------------------------------------
plot(ema1, "EMA 1", color = ema1Col, display = display.pane)
plot(ema2, "EMA 2", color = ema2Col, display = display.pane)
plot(ema3, "EMA 3", color = ema3Col, display = display.pane)

//-----------------------------------------------------------------------------


//-----------------------------------------------------------------------------
// Price Action Helpers
//-----------------------------------------------------------------------------
// Settings
//-----------------------------------------------------------------------------
bodySize = math.abs(close - open)
candleRange = high - low
upperWick = high - math.max(close, open)
lowerWick = math.min(close, open) - low

bullishEngulfing = close > open and close[1] < open[1] and close > open[1] and open < close[1]
bearishEngulfing = close < open and close[1] > open[1] and open > close[1] and close < open[1]
bullishPinBar = candleRange > 0 and lowerWick > bodySize * 2 and lowerWick > candleRange * 0.6
bearishPinBar = candleRange > 0 and upperWick > bodySize * 2 and upperWick > candleRange * 0.6
upInsideBar = close > open and high < high[1] and low > low[1]
dnInsideBar = close < open and high < high[1] and low > low[1]

plotshape(bullishEngulfing, "Bullish Engulfing", shape.triangleup, location.belowbar, color.new(AQUA_COLOR, 40), size = size.tiny, display = display.pane)
plotshape(bearishEngulfing, "Bearish Engulfing", shape.triangledown, location.abovebar, color.new(PURPLE_COLOR, 40), size = size.tiny, display = display.pane)
plotshape(bullishPinBar, "Bullish Pin", shape.diamond, location.belowbar, color.new(GREEN_COLOR, 40), size = size.tiny, display = display.pane)
plotshape(bearishPinBar, "Bearish Pin", shape.diamond, location.abovebar, color.new(RED_COLOR, 40), size = size.tiny, display = display.pane)
plotshape(upInsideBar, "Up Inside Bar", shape.circle, color = color.new(YELLOW_COLOR, 40), size = size.tiny, location = location.belowbar, display = display.pane)
plotshape(dnInsideBar, "Down Inside Bar", shape.circle, color = color.new(YELLOW_COLOR, 40), size = size.tiny, location = location.abovebar, display = display.pane)

//-----------------------------------------------------------------------------